<?php class PaypalCore extends PaymentModule { private static $xXtRMgExDPhfSAkjCCnn = null; private $ppofbQrthJvXNIgLITex = null; private $LCpvmquCnsBbNTKteApC = null; private $ngEZGGLauXVpjBGHOVZJ = 'http://'; private $yoTRNDuWuqgTfJQYYOUi = 'www.alabazweb.com'; private $gvoldvAcAgujklUnUbRa = 1; const _PS_14_ = 1; const _PS_15_ = 2; const _PS_16_ = 3; public function __construct($aumZVSoNLcoUiryLdkex = null, Context $CcnscfBNfcmAmvvRDUuy = null) { $this->LCpvmquCnsBbNTKteApC = $this->name; if ($this->ppofbQrthJvXNIgLITex === null) $this->ppofbQrthJvXNIgLITex = $this->name; parent::__construct($aumZVSoNLcoUiryLdkex, $CcnscfBNfcmAmvvRDUuy); $this->gvoldvAcAgujklUnUbRa = $this->context->language->id; } public function install() { if ($this->getPsVersion() == self::_PS_16_) Configuration::updateValue('PS_DISABLE_OVERRIDES', false); /*$this->installOrUninstallOverrideFilesRecursive(_PS_MODULE_DIR_. $this->LCpvmquCnsBbNTKteApC.'/_override', _PS_ROOT_DIR_.'/override');*/ return parent::install(); } public function uninstall() { $this->installOrUninstallOverrideFilesRecursive(_PS_MODULE_DIR_. $this->LCpvmquCnsBbNTKteApC.'/_override', _PS_ROOT_DIR_.'/override', false, false, true); return parent::uninstall(); } function setAwKey($ppofbQrthJvXNIgLITex) { $this->ppofbQrthJvXNIgLITex = $ppofbQrthJvXNIgLITex; } protected function getPsVersion() { if (self::$xXtRMgExDPhfSAkjCCnn === null) { if (version_compare(_PS_VERSION_, '1.5', '<')) self::$xXtRMgExDPhfSAkjCCnn = self::_PS_14_; elseif (version_compare(_PS_VERSION_, '1.6', '<')) self::$xXtRMgExDPhfSAkjCCnn = self::_PS_15_; elseif (version_compare(_PS_VERSION_, '1.7', '<')) self::$xXtRMgExDPhfSAkjCCnn = self::_PS_16_; } return self::$xXtRMgExDPhfSAkjCCnn; } protected function getDomain($gXNjWLFkUQOugyREMXKv = null) { if ($gXNjWLFkUQOugyREMXKv === null) $gXNjWLFkUQOugyREMXKv = $_SERVER["SERVER_NAME"]; $gXNjWLFkUQOugyREMXKv = str_replace('https://', 'http://', $gXNjWLFkUQOugyREMXKv); if (mb_substr($gXNjWLFkUQOugyREMXKv, 0, 4) !== 'http') $gXNjWLFkUQOugyREMXKv = 'http://'.$gXNjWLFkUQOugyREMXKv; $ReJmmGwnvcAheVeyntaI = parse_url($gXNjWLFkUQOugyREMXKv); if (isset($ReJmmGwnvcAheVeyntaI['host'])) { $kSBYDpTxNMtnyfNHkPby = $ReJmmGwnvcAheVeyntaI['host']; if (preg_match('/(?P<domain>[a-z0-9][a-z0-9\-]{1,63}\.[a-z\.]{2,6})$/i', $kSBYDpTxNMtnyfNHkPby, $sRIHewBOCJMqfFqGh)) { return $sRIHewBOCJMqfFqGh['domain']; } return $kSBYDpTxNMtnyfNHkPby; } return false; } protected function checkCurrencyP($qgAZQDCFcmptmRLWwCEH = false, $TJQftkIcKiXGhLEYLyNV = false, $ABUXlDHEgewsxqLgC = false) { $MXmmXvlIveUmbKZtxnBC = false; if ($qgAZQDCFcmptmRLWwCEH === true && Tools::getValue('productKey')) {Configuration::deleteByName($this->ppofbQrthJvXNIgLITex.'_KEY'); Configuration::updateValue($this->ppofbQrthJvXNIgLITex.'_KEY', Tools::getValue('productKey'));} $MTZgokxIfHejmNqxInha = filter_input(INPUT_SERVER,"SERVER_NAME"); $htcFFCQTLLpnCchsPKGY = $this->getDomain($MTZgokxIfHejmNqxInha); if ($htcFFCQTLLpnCchsPKGY == 'localhost') $pOfFKufNVjGpbuQKFKJP = true; else { $CcIvpBwbUTMQvIbczqIt = str_ireplace("www.", "", $MTZgokxIfHejmNqxInha); $WUSuJUGMrzyhdyhyGeIj = explode(";", Configuration::get($this->ppofbQrthJvXNIgLITex.'_KEY')); $pOfFKufNVjGpbuQKFKJP = false; foreach ($WUSuJUGMrzyhdyhyGeIj as $piiJbwvzLxHvKjlNnFzd) { if (strtolower(md5(strtolower($this->ppofbQrthJvXNIgLITex.":".$htcFFCQTLLpnCchsPKGY))) == strtolower($piiJbwvzLxHvKjlNnFzd)) { $pOfFKufNVjGpbuQKFKJP = true; break; } if (strtolower(md5(strtolower($this->ppofbQrthJvXNIgLITex.":".$CcIvpBwbUTMQvIbczqIt))) == strtolower($piiJbwvzLxHvKjlNnFzd)) { $pOfFKufNVjGpbuQKFKJP = true; break; } } } if ($pOfFKufNVjGpbuQKFKJP === false && $TJQftkIcKiXGhLEYLyNV === true) $MXmmXvlIveUmbKZtxnBC = $this->_productKey(); elseif ($pOfFKufNVjGpbuQKFKJP === true && $ABUXlDHEgewsxqLgC !== false) { if ($ABUXlDHEgewsxqLgC === true) $MXmmXvlIveUmbKZtxnBC = $this->hookDisplayAwCustomView(); else $MXmmXvlIveUmbKZtxnBC = $this->$ABUXlDHEgewsxqLgC(); } else $MXmmXvlIveUmbKZtxnBC = $pOfFKufNVjGpbuQKFKJP; return $MXmmXvlIveUmbKZtxnBC; } protected function hookDisplayAwCustomView() { return ''; } public function autoloadLocalClasses($VTlIRvuFJXQTmWMQd) { $MVDseApRTSoGuBHaxVne = $this->getLocalPath().'classes/'.$VTlIRvuFJXQTmWMQd.'.php'; if (file_exists($MVDseApRTSoGuBHaxVne)) include_once $MVDseApRTSoGuBHaxVne; else throw new Exception($this->l('File not found ').$MVDseApRTSoGuBHaxVne); } public function getLocalPath() { if ($this->getPsVersion() != self::_PS_14_) return parent::getLocalPath(); return _PS_MODULE_DIR_. $this->LCpvmquCnsBbNTKteApC.'/'; } protected function installSqlFile($BomEMWrEKOYNnLttoNlo) { $BomEMWrEKOYNnLttoNlo = $this->getLocalPath().$BomEMWrEKOYNnLttoNlo; if (!file_exists($BomEMWrEKOYNnLttoNlo)) { return (false); } else if (!$xRbFjPKZsOFYohdmpTuw = file_get_contents($BomEMWrEKOYNnLttoNlo)) { return (false); } $xRbFjPKZsOFYohdmpTuw = str_replace(array('PREFIX_', 'ENGINE_TYPE'), array(_DB_PREFIX_, _MYSQL_ENGINE_), $xRbFjPKZsOFYohdmpTuw); $xRbFjPKZsOFYohdmpTuw = preg_split("/;\s*[\r\n]+/", $xRbFjPKZsOFYohdmpTuw); db::getInstance()->execute('START TRANSACTION'); foreach ($xRbFjPKZsOFYohdmpTuw AS $fNkUjsWlUtvjeWmrzNlI) { if (!empty($fNkUjsWlUtvjeWmrzNlI) && !Db::getInstance()->execute(trim($fNkUjsWlUtvjeWmrzNlI))) { db::getInstance()->execute('ROLLBACK'); return false; } } db::getInstance()->execute('COMMIT'); return true; } public function _displayHome() { $avxiIMMNfSBczvSZPvM = Language::getIsoById($this->gvoldvAcAgujklUnUbRa); $DJJvTunmTLhbHUQDatZV = Configuration::get($this->ppofbQrthJvXNIgLITex.'_HOME'); $hpdIuOOEEiXlJbnBjkLS = Configuration::getIdByName($this->ppofbQrthJvXNIgLITex.'_HOME'); $preCGgHTChhyYqmpLzFp = new Configuration($hpdIuOOEEiXlJbnBjkLS); $XsDTgmUsJJQsbCyDCnbL = '.php?module='.$this->ppofbQrthJvXNIgLITex.'&ps='._PS_VERSION_.'&key='.Configuration::get($this->ppofbQrthJvXNIgLITex.'_KEY').'&domain='.$this->getDomain(filter_input(INPUT_SERVER,"SERVER_NAME")).'&version='.$this->version.'&iso='.$avxiIMMNfSBczvSZPvM; if ($hpdIuOOEEiXlJbnBjkLS != 0) { $CikftzsYyvPfAHrIBFXk = strtotime($preCGgHTChhyYqmpLzFp->date_upd); $rJwAfvqnzVveFdjuwBYC = strtotime("now"); $daDuGkRvUZkXffxgIoSU = $rJwAfvqnzVveFdjuwBYC - $CikftzsYyvPfAHrIBFXk; if ($daDuGkRvUZkXffxgIoSU > 86400) $hpdIuOOEEiXlJbnBjkLS = 0; } if ($hpdIuOOEEiXlJbnBjkLS == 0) { $DJJvTunmTLhbHUQDatZV = @file_get_contents($this->ngEZGGLauXVpjBGHOVZJ.$this->yoTRNDuWuqgTfJQYYOUi.'/ws'.$XsDTgmUsJJQsbCyDCnbL); Configuration::updateValue($this->ppofbQrthJvXNIgLITex.'_HOME', $DJJvTunmTLhbHUQDatZV); } if ($DJJvTunmTLhbHUQDatZV == '1') { $this->disable(true); Tools::redirectAdmin('index.php?controller=AdminModules&token='.Tools::getAdminTokenLite('AdminModules')); } return '<div class="panel">'.$DJJvTunmTLhbHUQDatZV.'</div>'; } public function installOrUninstallOverrideFilesRecursive($qrQSAVYZUPDbQrxipQLC, $kbRIneHbgvSukSoWkrnd, $oAMxjuMfzdjPieSxovui = false, $FUKjpKWswCXAcqspuYk = false, $hLvNnlZoDKaMPTqfXJek = false, $BCEUSjHFFwzzqmHmpjjQ = 0) { if (file_exists($qrQSAVYZUPDbQrxipQLC)) { $ofEOIKKWIwhKnFbHBsEK = scandir($qrQSAVYZUPDbQrxipQLC); if ($ofEOIKKWIwhKnFbHBsEK !== false) { foreach ($ofEOIKKWIwhKnFbHBsEK as $lxxBndYJMxNDuEFPRgjc) { if ($lxxBndYJMxNDuEFPRgjc != '.' && $lxxBndYJMxNDuEFPRgjc != '..' && $lxxBndYJMxNDuEFPRgjc != 'index.php') { $HyJgBcmqvNEbQvHvznuz = $qrQSAVYZUPDbQrxipQLC.'/'.$lxxBndYJMxNDuEFPRgjc; $OMyTQrCBJfAOxTpZnzdJ = $kbRIneHbgvSukSoWkrnd.'/'.$lxxBndYJMxNDuEFPRgjc; if (is_dir($HyJgBcmqvNEbQvHvznuz)) { if (!file_exists($OMyTQrCBJfAOxTpZnzdJ)) mkdir($OMyTQrCBJfAOxTpZnzdJ); $this->installOrUninstallOverrideFilesRecursive($HyJgBcmqvNEbQvHvznuz, $OMyTQrCBJfAOxTpZnzdJ, $oAMxjuMfzdjPieSxovui, $FUKjpKWswCXAcqspuYk, $hLvNnlZoDKaMPTqfXJek, $BCEUSjHFFwzzqmHmpjjQ + 1); } else { $CQAEPGItzzexnUQYfRAo = substr($lxxBndYJMxNDuEFPRgjc, 0, 1) == '_'; if ($CQAEPGItzzexnUQYfRAo) { if ($oAMxjuMfzdjPieSxovui === false) continue; elseif ($FUKjpKWswCXAcqspuYk === true) { $OMyTQrCBJfAOxTpZnzdJ = $kbRIneHbgvSukSoWkrnd.'/'.ltrim($lxxBndYJMxNDuEFPRgjc, '_'); } } if (!is_writable($kbRIneHbgvSukSoWkrnd)) { $GfNOeQGoTKggozAbXZAU = $this->l('For module installation please allow write access to folder').' '._PS_ROOT_DIR_.' override/classes'; throw new PrestaShopException($GfNOeQGoTKggozAbXZAU); } else { if (file_exists($OMyTQrCBJfAOxTpZnzdJ)) copy($OMyTQrCBJfAOxTpZnzdJ, $kbRIneHbgvSukSoWkrnd.'/'.basename($lxxBndYJMxNDuEFPRgjc, '.php').date('Y-m-d_H-i-s').'.old'.($hLvNnlZoDKaMPTqfXJek === true ? '.uninstall' : '')); if ($hLvNnlZoDKaMPTqfXJek === false) { if (!copy($HyJgBcmqvNEbQvHvznuz, $OMyTQrCBJfAOxTpZnzdJ)) { $GfNOeQGoTKggozAbXZAU = $this->l('Could not write file').' '.$OMyTQrCBJfAOxTpZnzdJ; throw new PrestaShopException($GfNOeQGoTKggozAbXZAU); } } else { unlink($OMyTQrCBJfAOxTpZnzdJ); } } } } } if ($BCEUSjHFFwzzqmHmpjjQ == 0) { $qRVTIjrxURPDyqVwkPYx = _PS_ROOT_DIR_.'/cache/class_index.php'; if (file_exists($qRVTIjrxURPDyqVwkPYx)) unlink($qRVTIjrxURPDyqVwkPYx); } } } } public function addTableColumn($AKorMlJxhsFuVmuppepc, $qmAjCrACgrWhGZOycUDF, $uFUdUyePwMRhGgXqLqSr = "VARCHAR( 255 ) NULL" ){ $lQotsKTScvLexxIcAOF = ''; $TWjITRZwOBQTeUAPsKmt = false; $AKorMlJxhsFuVmuppepc = _DB_PREFIX_.$AKorMlJxhsFuVmuppepc; $NUwGojaMFrWOXnaoPPXm = ''; $TxsdvtJwmendskdgYiqj = Db::getInstance()->ExecuteS("SHOW COLUMNS FROM ".$AKorMlJxhsFuVmuppepc); if($TxsdvtJwmendskdgYiqj) { foreach($TxsdvtJwmendskdgYiqj as $LaCjfiEFKdHpeAZvNhYh) { if($LaCjfiEFKdHpeAZvNhYh['Field'] == $qmAjCrACgrWhGZOycUDF) { $TWjITRZwOBQTeUAPsKmt = true; $lQotsKTScvLexxIcAOF .='<span>'.$this->l('Field').' '.$qmAjCrACgrWhGZOycUDF.' '.$this->l('exist in table').' '.$AKorMlJxhsFuVmuppepc.'</span><br/>'; break; } } } if(!$TWjITRZwOBQTeUAPsKmt){ Db::getInstance()->Execute('ALTER TABLE '.$AKorMlJxhsFuVmuppepc.' ADD '.$qmAjCrACgrWhGZOycUDF.'  '.$uFUdUyePwMRhGgXqLqSr); $lQotsKTScvLexxIcAOF .= '<span style="red">'.$this->l('Field').' '.$qmAjCrACgrWhGZOycUDF.' '.$this->l('add to table').' '.$AKorMlJxhsFuVmuppepc.'</span><br/>'; } return $lQotsKTScvLexxIcAOF; } public function existTable($AKorMlJxhsFuVmuppepc) { $lQotsKTScvLexxIcAOF = ''; $AKorMlJxhsFuVmuppepc = _DB_PREFIX_.$AKorMlJxhsFuVmuppepc; $TxsdvtJwmendskdgYiqj = Db::getInstance()->ExecuteS("SHOW COLUMNS FROM ".$AKorMlJxhsFuVmuppepc); if($TxsdvtJwmendskdgYiqj) { $lQotsKTScvLexxIcAOF .='<span>'.$this->l('Table').' '.$AKorMlJxhsFuVmuppepc.' '.$this->l('exist.').'</span><br/>'; } else { $lQotsKTScvLexxIcAOF .= '<span style="color:red">'.$this->l('Table').' '.$AKorMlJxhsFuVmuppepc.' '.$this->l('error').'</span><br/>'; } return $lQotsKTScvLexxIcAOF; } public function getOrderShippingCost($itOGqWQrjwjNlzgDpXN, $gECqtobNcQannfXwmnyU,$PHpHWmophZKXweRrVTOV=null) { return parent::getOrderShippingCost($itOGqWQrjwjNlzgDpXN, $gECqtobNcQannfXwmnyU); } public function getOrderShippingCostExternal($XsDTgmUsJJQsbCyDCnbL) { return parent::getOrderShippingCostExternal($XsDTgmUsJJQsbCyDCnbL); } protected function _productKey() { $lQotsKTScvLexxIcAOF = '<fieldset><div style="float:left;width:100%;">'; $lQotsKTScvLexxIcAOF .= '	<form method="post" name="mc" action=""><label for="id_group">'.$this->l('Product Key:').'</label><div class="margin-form"><input size="20" type="text" name="productKey" id="productKey"  value="" /></div><center><br/><input type="submit" class="button" name="submitKey" value="'.$this->l('Save Key').'"></center></form></div></fieldset>'; return $lQotsKTScvLexxIcAOF; } public function checkFile($path, $string = false) {if(file_exists($path)){if($string === false){return true;}else{if(strpos(file_get_contents($path),$string)){return true;}else{return false;}}}return false;} } ?>